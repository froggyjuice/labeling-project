<script>
// ìë™ ì €ì¥ ê¸°ëŠ¥ - í˜ì´ì§€ ë¡œë“œ í›„ ì ìš©
window.addEventListener('load', function() {
    console.log('ğŸ”„ ìë™ ì €ì¥ ê¸°ëŠ¥ í™œì„±í™”');
    
    // ê¸°ì¡´ selectLabel í•¨ìˆ˜ë¥¼ ë˜í•‘
    if (window.selectLabel && window.labelingState) {
        const originalSelectLabel = window.selectLabel;
        
        window.selectLabel = async function(label) {
            // ê¸°ì¡´ ë¡œì§ ì‹¤í–‰
            originalSelectLabel(label);
            
            // ìë™ ì €ì¥ ì‹¤í–‰
            setTimeout(async () => {
                if (window.labelingState.selectedLabels.length > 0) {
                    const currentImageId = window.labelingState.getCurrentImageId();
                    if (currentImageId) {
                        try {
                            const success = await window.labelingState.saveLabelToServer(
                                currentImageId, 
                                window.labelingState.selectedLabels
                            );
                            if (success) {
                                window.labelingState.hasChanges = false;
                                console.log('âœ… ìë™ ì €ì¥ ì™„ë£Œ');
                                showSaveNotification('ğŸ’¾ ìë™ ì €ì¥ë¨');
                            }
                        } catch (error) {
                            console.error('ìë™ ì €ì¥ ì‹¤íŒ¨:', error);
                        }
                    }
                }
            }, 100);
        };
    }
    
    // ì €ì¥ ì•Œë¦¼ í‘œì‹œ
    function showSaveNotification(message) {
        const notification = document.createElement('div');
        notification.style.cssText = `
            position: fixed; top: 80px; right: 20px; 
            background: #28a745; color: white; 
            padding: 8px 16px; border-radius: 6px; 
            font-size: 14px; z-index: 1000;
            opacity: 0; transition: opacity 0.3s;
        `;
        notification.textContent = message;
        document.body.appendChild(notification);
        
        setTimeout(() => notification.style.opacity = '1', 10);
        setTimeout(() => {
            notification.style.opacity = '0';
            setTimeout(() => notification.remove(), 300);
        }, 1500);
    }
    
    // ì €ì¥ ë²„íŠ¼ ìˆ˜ì •
    const saveBtn = document.querySelector('button[onclick*="saveProgress"]');
    if (saveBtn) {
        saveBtn.textContent = 'ğŸ“Š ì§„í–‰ë¥  ë°±ì—…';
        saveBtn.style.opacity = '0.7';
    }
    
    console.log('âœ… ìë™ ì €ì¥ ì„¤ì • ì™„ë£Œ');
});
</script> 